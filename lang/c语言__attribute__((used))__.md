在 C 语言中，`__attribute__((used))` 是 GNU 编译器（如 GCC 和 Clang）提供的一个 **编译器属性** ，用于明确告诉编译器 **"即使符号未被直接引用，也不要优化掉它"** 。它在特定场景下非常有用，尤其是在链接阶段需要保留某些变量或函数时。

# **核心作用**

* **防止编译器优化**
  编译器在优化代码时，可能会移除未被显式调用的函数或未使用的变量。通过 `used` 属性，可以强制保留这些符号（即使它们看起来"未被使用"）。
* **确保符号出现在目标文件中**
  被标记为 `used` 的符号会保留在目标文件（`.o` 文件）中，即使未被直接调用。这在链接阶段可能非常重要（例如，被链接脚本引用）。

# **典型使用场景**

## 1. 保留未显式调用的函数或变量

例如：

```c
// 即使未被调用，也会保留此函数
__attribute__((used)) void unused_function() {
    // ...
}

// 即使未被引用，也会保留此变量
__attribute__((used)) int unused_variable = 42;
```

## 2. 中断服务程序（ISR）

在嵌入式开发中，中断服务函数通常不会被代码显式调用，但需要确保编译器不优化它们：

```c
__attribute__((used)) void __isr_handler() {
    // 中断处理逻辑
}
```

## 3. 链接脚本中的符号引用

如果链接脚本（Linker Script）需要引用某个符号（例如指定内存布局），但代码中未显式使用该符号，可以用 `used` 属性保留它：

```c
__attribute__((used)) int _my_section_start;
```

# **对比 `__attribute__((unused))`**

* `used`: 强制保留符号，即使未被使用。
* `unused`: 告诉编译器"此符号可能未被使用"，避免编译器发出"未使用"警告。

示例：

```c
// 避免未使用警告，但允许编译器优化
void unused_func() __attribute__((unused));
```
