# ipv4分片报文

IPv4分片标志包含在IPv4 Header中，即Flags字段，该字段一共占用3bit。各个bit的含义如下：

```bash
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Version|  IHL  |Type of Service|          Total Length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Identification        |Flags|      Fragment Offset    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Time to Live |    Protocol   |         Header Checksum       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Source Address                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Destination Address                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

* bit0: 保留位，必须为0;
* bit1: DF（Don't Fragment），表明报文能否分片，0表示可以分片，1表示不能分片;
* bit2: MF（More Fragment），表明该报文是否为最后一片，0表示最后一片，1代表后面还有;

# ipv6分片报文

与IPv4不同，IPv6的分片标志不包含在IPv6 Header中，而是体现在IPv6的扩展头Fragment Header中。但在IPv6 Header中，Next Header的值必须为44（Fragment Header for IPv6）。

根据RFC2460中的定义，Fragment Header格式如下：

```bash
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Next Header  |   Reserved    |      Fragment Offset    |Res|M|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Identification                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

其中：

* Next Header：标识源数据包也就是分片之前数据包中可分片部分的数据首部的类型;
* Reserved：保留字段，发送时初始化为零; 接收时忽略;
* Fragment Offset：同IPv4一样，13bits，表示此数据包在完整原始数据包中的位置，用偏移量表示，一个偏移量为8byte。比如fragment_offset=4，则偏移4*8=32个字节;
* Res：保留位，发送时初始化为零，接收时忽略;
* M：1=中间分片，0=最后一个分片;
* Identification：同一个源数据包的分片标识，当源节点发送一个大于MTU的数据包时，将对数据包进行分片，此时需要给各个分片包定义一个标识值;
